<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>المصروفات الذكية</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#4338ca">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root { --c-primary: #4f46e5; --c-secondary: #f3f4f6; --c-text-primary: #111827; --c-text-secondary: #6b7280; --c-bg-primary: #ffffff; --c-bg-secondary: #f9fafb; --c-border: #e5e7eb; --c-success: #10b981; --c-danger: #ef4444; --grad-primary: linear-gradient(135deg, #6366f1, #4f46e5); --grad-fab: linear-gradient(45deg, #f43f5e, #f97316); --grad-bg: linear-gradient(135deg, #f9fafb, #e5e7eb); --space-sm: 0.5rem; --space-md: 1rem; --space-lg: 1.5rem; --font-main: 'Cairo', sans-serif; --fs-sm: 0.875rem; --fs-lg: 1.125rem; --fs-2xl: 2rem; --radius-md: 0.75rem; --radius-lg: 1rem; --radius-full: 9999px; --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1); --transition: all 0.3s ease-in-out; }
        [data-theme="dark"] { --c-primary: #6366f1; --c-secondary: #374151; --c-text-primary: #f9fafb; --c-text-secondary: #9ca3af; --c-bg-primary: #111827; --c-bg-secondary: #1f2937; --c-border: #374151; --grad-bg: linear-gradient(135deg, #1f2937, #111827); }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-main); background: var(--grad-bg); color: var(--c-text-primary); }
        #app-container { max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; background-color: var(--c-bg-primary); position: relative; overflow: hidden; box-shadow: 0 0 40px rgba(0,0,0,0.1); }
        .screen { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-lg); }
        .hidden { display: none !important; }
        #main-app { justify-content: flex-start; padding: 0; }
        .app-header { width: 100%; padding: var(--space-md); display: flex; justify-content: space-between; align-items: center; background-color: color-mix(in srgb, var(--c-bg-primary) 80%, transparent); backdrop-filter: blur(10px); border-bottom: 1px solid var(--c-border); z-index: 10; flex-shrink: 0; }
        #main-content { flex-grow: 1; width: 100%; overflow-y: auto; padding: var(--space-md); }
        .app-nav { display: grid; grid-template-columns: repeat(5, 1fr); align-items: center; width: 100%; background-color: var(--c-bg-primary); border-top: 1px solid var(--c-border); z-index: 10; box-shadow: 0 -5px 15px -3px rgba(0,0,0,0.05); }
        .btn, .nav-btn { border: none; cursor: pointer; font-family: inherit; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm); transition: var(--transition); border-radius: var(--radius-md); }
        .btn-primary { background: var(--grad-primary); color: #ffffff; box-shadow: var(--shadow-md); padding: var(--space-sm) var(--space-md); }
        .btn-secondary { background-color: var(--c-secondary); color: var(--c-text-primary); padding: var(--space-sm) var(--space-md); }
        .btn-danger { background-color: var(--c-danger); color: #ffffff; padding: var(--space-sm) var(--space-md); }
        .nav-btn { flex-direction: column; gap: .25rem; font-size: var(--fs-sm); color: var(--c-text-secondary); background: transparent; padding: var(--space-sm) 0; height: 100%; }
        .nav-btn.active { color: var(--c-primary); }
        .nav-fab { width: 60px; height: 60px; border-radius: var(--radius-full); background: var(--grad-fab); color: #ffffff; box-shadow: var(--shadow-lg); display: flex; align-items: center; justify-content: center; border: 4px solid var(--c-bg-primary); cursor: pointer; transform: translateY(-20px); z-index: 1; }
        .auth-card { text-align: center; padding: calc(var(--space-lg) * 2); animation: fadeIn .5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .logo { width: 60px; height: 60px; background: var(--grad-primary); color: #ffffff; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-md); }
        .auth-buttons { display: flex; flex-direction: column; gap: var(--space-md); margin-top: var(--space-lg); }
        .user-profile { display: flex; align-items: center; gap: var(--space-md); }
        #user-avatar { width: 40px; height: 40px; border-radius: var(--radius-full); object-fit: cover; background-color: var(--c-secondary); border: 2px solid var(--c-primary); }
        .page { display: flex; flex-direction: column; gap: var(--space-md); animation: fadeIn .5s; width: 100%; }
        .card { background-color: var(--c-bg-primary); padding: var(--space-md); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); border: 1px solid var(--c-border); }
        .card h3 { font-size: var(--fs-lg); margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-sm); }
        .card .amount { font-size: var(--fs-2xl); font-weight: 700; color: var(--c-primary); }
        .item-list { display: flex; flex-direction: column; gap: var(--space-sm); }
        .expense-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: var(--space-md); padding: var(--space-sm); border-radius: var(--radius-md); border-bottom: 1px solid var(--c-border); }
        .item-icon { width: 40px; height: 40px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: #ffffff; flex-shrink: 0; }
        .item-details { overflow: hidden; } .item-name { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } .item-category { font-size: var(--fs-sm); color: var(--c-text-secondary); } .item-amount { font-weight: 700; white-space: nowrap; }
        .item-actions { display: flex; } .item-actions button { color: var(--c-text-secondary); background: transparent; border: none; padding: .5rem; cursor: pointer; }
        .category-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: var(--space-md); padding: var(--space-sm); border-radius: var(--radius-md); border-bottom: 1px solid var(--c-border); }
        .modal-backdrop { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 50; backdrop-filter: blur(4px); opacity: 0; transition: opacity .3s; }
        .modal-backdrop.active { display: flex; opacity: 1; }
        .modal { background-color: var(--c-bg-primary); padding: var(--space-lg); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); width: 90%; max-width: 400px; transform: scale(.95); opacity: 0; transition: all .3s; }
        .modal-backdrop.active .modal { transform: scale(1); opacity: 1; }
        .modal-actions { display: flex; justify-content: flex-end; gap: var(--space-md); margin-top: var(--space-md); }
        .form-group { display: flex; flex-direction: column; gap: var(--space-sm); margin-bottom: var(--space-md); }
        input, select { width: 100%; padding: var(--space-sm) var(--space-md); border: 1px solid var(--c-border); border-radius: var(--radius-md); background-color: var(--c-bg-secondary); font-family: inherit; font-size: var(--fs-base); }
        input[type="color"] { padding: 2px; height: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--c-secondary); border-top-color: var(--c-primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .empty-state { text-align: center; color: var(--c-text-secondary); padding: calc(var(--space-lg) * 2) 0; }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- App content will be rendered here by JavaScript -->
    </div>
    <div id="modal-container"></div>
    
    <!-- Use Firebase Modular SDK (v9+) for better performance -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInAnonymously, signOut } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      import { getFirestore, collection, doc, addDoc, getDoc, updateDoc, deleteDoc, onSnapshot, query, where, orderBy, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";
      
      const firebaseConfig = { apiKey: "AIzaSyCD6TOeIO7g6RGp89YtA1maduwMfyTE1VQ", authDomain: "my-expenses-81714.firebaseapp.com", projectId: "my-expenses-81714", storageBucket: "my-expenses-81714.firebasestorage.app", messagingSenderId: "672207051964", appId: "1:672207051964:web:b6e0cedc143bd06fd584b9" };

      // Make all functions and variables available to the main app script
      window.firebaseServices = {
        initializeApp, getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInAnonymously, signOut,
        getFirestore, collection, doc, addDoc, getDoc, updateDoc, deleteDoc, onSnapshot, query, where, orderBy, writeBatch, serverTimestamp,
        firebaseConfig
      };
    </script>
    
    <script type="module" src="./app.js"></script>
    <script>if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }</script>
</body>
</html>
